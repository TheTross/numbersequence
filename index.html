<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kindergarten Number & Letter Adventure</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ffe0f7, #e3f2fd);
      display: flex;
      align-items: stretch;
      justify-content: stretch;
    }
    .app { flex: 1; display: flex; flex-direction: column; }
    .page {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
      text-align: center;
    }
    h1 { font-size: 26px; margin: 4px 0 10px; color: #6a1b9a; }
    h2 { font-size: 22px; margin: 8px 0; color: #3949ab; }
    p { margin: 4px 0; }

    .big-number {
      font-size: 90px;
      font-weight: bold;
      margin: 10px 0 4px;
      color: #ff7043;
      text-shadow: 0 3px 0 #ffccbc;
      border-radius: 24px;
      padding: 10px 24px;
      background: linear-gradient(135deg, #ffe0b2, #ffccbc);
      border: 3px solid #ffab91;
    }
    .word { font-size: 22px; margin-bottom: 10px; text-transform: capitalize; color: #5d4037; }
    .dots { margin: 10px 0 8px; }
    .dot { display: inline-block; width: 20px; height: 20px; margin: 4px; border-radius: 50%; background: #ffca28; }

    .nav {
      display: flex;
      justify-content: space-between;
      padding: 8px 16px 12px;
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(4px);
    }
    button {
      background: #42a5f5;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
    }
    button:disabled { background: #cfd8dc; cursor: default; }

    .pill {
      display: inline-block;
      padding: 4px 12px;
      font-size: 13px;
      border-radius: 999px;
      background: #e3f2fd;
      color: #1976d2;
      margin-bottom: 8px;
    }
    .tagline { font-size: 15px; color: #7e57c2; margin-bottom: 6px; }
    .sequence-row { font-size: 28px; margin: 14px 0; }
    .num-input {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      border: 2px solid #90a4ae;
      text-align: center;
      font-size: 22px;
      margin: 0 4px;
    }
    .feedback { min-height: 22px; font-size: 15px; margin-top: 8px; }
    .good { color: #2e7d32; }
    .bad { color: #c62828; }

    .choices { margin: 10px 0; }
    .choice-btn {
      background: #fff3e0;
      color: #ef6c00;
      border-radius: 18px;
      border: 2px solid #ffb74d;
      margin: 4px;
      padding: 8px 12px;
      font-size: 18px;
      cursor: pointer;
      font-weight: bold;
    }
    .choice-btn.selected {
      background: #ffe0b2;
      border-color: #fb8c00;
    }
    .card-row { display: flex; justify-content: center; gap: 12px; margin-top: 12px; }
    .card {
      width: 80px;
      height: 80px;
      border-radius: 16px;
      border: 2px solid #ce93d8;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f3e5f5;
      cursor: pointer;
    }
    .card.selected {
      background: #e1bee7;
      border-color: #ab47bc;
    }
    .card span { font-size: 30px; color: #6a1b9a; font-weight: bold; }

    .home-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 16px;
      width: 100%;
      max-width: 480px;
    }
    .home-btn {
      border-radius: 16px;
      border: 2px solid #bbdefb;
      background: #e3f2fd;
      padding: 12px 6px;
      font-size: 14px;
      color: #1e88e5;
      cursor: pointer;
    }
    .home-btn b { display: block; font-size: 15px; margin-bottom: 4px; }

    .number-line {
      display: grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 8px;
      margin: 16px 0 8px;
      max-width: 520px;
      width: 100%;
    }
    .number-bubble {
      width: 46px;
      height: 46px;
      border-radius: 18px;
      border: 3px solid #90caf9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: bold;
      background: #e3f2fd;
      cursor: pointer;
      transition: transform 0.15s, background 0.15s, border-color 0.15s, box-shadow 0.15s, opacity 0.15s;
      box-shadow: 0 2px 0 #bbdefb;
    }
    .number-bubble.clicked { border-color: #42a5f5; background: #bbdefb; transform: scale(1.12); box-shadow: 0 3px 0 #90caf9; }
    .number-bubble.correct { border-color: #2e7d32; background: #c8e6c9; }
    .number-bubble.eliminated { opacity: 0.25; }

    .guess-step-buttons { margin-top: 8px; }
    .step-btn {
      background: #fffde7;
      color: #f9a825;
      border-radius: 16px;
      border: 2px solid #fff59d;
      padding: 4px 10px;
      margin: 0 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
    }
    .step-btn.active { background: #fff9c4; border-color: #fbc02d; }

    .scramble-toggle { margin-top: 6px; font-size: 13px; color: #455a64; }
    .scramble-toggle label { cursor: pointer; }

    .stats { margin-top: 6px; font-size: 14px; color: #37474f; }

    .present-modal {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background-color: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .present-content {
      background: #ffffff;
      border-radius: 20px;
      padding: 20px 24px;
      text-align: center;
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }
    .present-emoji { font-size: 48px; margin-bottom: 8px; }

    .collection { margin-top: 6px; font-size: 18px; color: #5d4037; }
    .collection span { font-size: 26px; margin: 0 4px; }

    /* Letter & vowel games */
    .letter-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 6px;
      margin: 12px 0;
      max-width: 520px;
      width: 100%;
    }
    .letter-btn {
      background: #ffe0b2;
      border-radius: 14px;
      border: 2px solid #ffb74d;
      padding: 6px 0;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }
    .letter-icon { font-size: 72px; margin-top: 8px; }

    .case-toggle { margin-top: 8px; font-size: 13px; color: #455a64; }
    .case-toggle label { cursor: pointer; margin: 0 8px; }

    .vowel-grid { display: flex; justify-content: center; gap: 10px; margin: 12px 0; }
    .vowel-btn {
      background: #fff3e0;
      border-radius: 18px;
      border: 2px solid #ff9800;
      padding: 10px 18px;
      font-size: 38px;
      font-weight: bold;
      cursor: pointer;
      min-width: 70px;
    }

    /* Unscramble game */
    .unscramble-letters {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 12px 0;
      font-size: 26px;
      font-weight: bold;
    }
    .unscramble-letter-box {
      border: 2px solid #90a4ae;
      border-radius: 12px;
      padding: 8px 14px;
      min-width: 32px;
      cursor: pointer;
      background: #e3f2fd;
    }
    .unscramble-letter-box.used { opacity: 0.3; }
    .unscramble-input {
      margin-top: 10px;
      font-size: 24px;
      padding: 6px 10px;
      border-radius: 10px;
      border: 2px solid #90a4ae;
      text-align: center;
      width: 140px;
    }
    .unscramble-emoji { font-size: 72px; margin-top: 10px; }

    /* WH words activity */
    .wh-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 16px 0;
      max-width: 520px;
    }
    .wh-btn {
      background: #e8f5e9;
      border-radius: 16px;
      border: 2px solid #81c784;
      padding: 8px 14px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      min-width: 80px;
    }
    .wh-display { margin-top: 16px; font-size: 20px; }
    .wh-big-word {
      font-size: 46px;
      font-weight: bold;
      margin-bottom: 4px;
      color: #1b5e20;
    }
    .wh-emoji {
      font-size: 64px;
      margin-bottom: 8px;
      color: #1b5e20;
    }
  </style>
</head>
<body>
  <!-- Present popup -->
  <div id="presentModal" class="present-modal">
    <div class="present-content">
      <div class="present-emoji">üéÅ</div>
      <h2>Wow! You won a prize!</h2>
      <p>Check your collection to see what you got!</p>
      <button onclick="closePresentPopup()">Close</button>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="soundClick" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
  <audio id="soundError" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
  <audio id="soundSuccess" src="https://assets.mixkit.co/active_storage/sfx/2014/2014-preview.mp3"></audio>
  <audio id="letterSound" src=""></audio>

  <div class="app">
    <div id="page" class="page"></div>
    <div class="nav">
      <button id="homeBtn">üè† Home</button>
      <button id="prevBtn">‚óÄ Back</button>
      <button id="nextBtn">Next ‚ñ∂</button>
    </div>
  </div>

  <script>
    function playSound(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.currentTime = 0;
      el.play().catch(() => {});
    }

    function showPresentPopup() {
      const modal = document.getElementById("presentModal");
      if (!modal) return;
      modal.style.display = "flex";
    }
    window.closePresentPopup = function() {
      const modal = document.getElementById("presentModal");
      if (!modal) return;
      modal.style.display = "none";
    };

    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    let scrambleActivities = false;
    let totalGuesses = 0;
    let totalWins = 0;

    const possibleGifts = ["üê∂", "üê±", "üöó", "üöÄ", "ü¶ï", "ü¶Ñ"];
    let giftCollection = [];

    function awardGift() {
      const gift = possibleGifts[Math.floor(Math.random() * possibleGifts.length)];
      giftCollection.push(gift);
    }

    function updateStatsDisplay() {
      const statsEls = document.querySelectorAll(".stats");
      statsEls.forEach(el => {
        el.textContent = `Guesses: ${totalGuesses} | Wins: ${totalWins}`;
      });
      const collEls = document.querySelectorAll(".collection");
      const text = giftCollection.length
        ? "Gifts: " + giftCollection.map(g => `<span>${g}</span>`).join("")
        : "Gifts: (keep winning to collect prizes!)";
      collEls.forEach(el => {
        el.innerHTML = text;
      });
    }

    function handleWin() {
      totalWins++;
      if (totalWins > 0 && totalWins % 5 === 0) {
        awardGift();
        showPresentPopup();
      }
    }

    // selections for number games
    let activitySelectedNumber = null; // from number line
    let activitySelectedTop = null;    // from top choices/cards

    const numberWords = ["","one","two","three","four","five","six","seven","eight","nine","ten"];
    const numberPages = Array.from({ length: 10 }, (_, i) => ({ type:"number", n:i+1 }));

    const missingPages = [
      { sequence:[1,2,null,4], answers:[3] },
      { sequence:[3,null,5], answers:[4] },
      { sequence:[3,null,7], answers:[5] },
      { sequence:[6,7,null,9,10], answers:[8] },
      { sequence:[2,null,6,null,10], answers:[4,8] }
    ];

    const relationPages = [
      { mode:"before", shown:5, answer:4 },
      { mode:"after", shown:7, answer:8 },
      { mode:"between", left:4, right:6, answer:5 }
    ];

    const extraPages = [
      { type:"match", number:4, options:[2,4,6] },
      { type:"nextNumber", start:3, options:[2,4,5] },
      { type:"finishSequence", pattern:[1,2,3], correctNext:4, choices:[4,5,6] },
      { type:"cardPick", displaySequence:[5,null,7], correct:6, cardOptions:[4,6,8] }
    ];

    const guessMin = 0;
    const guessMax = 20;
    let guessStep = 1;
    let secretNumber = null;
    let guessMessage = "";
    let eliminated = {};

    function resetGuessGame() {
      secretNumber = Math.floor(Math.random() * (guessMax - guessMin + 1)) + guessMin;
      guessMessage = "Tap a number to guess. I‚Äôll say if my number is higher or lower.";
      eliminated = {};
    }

    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    const letterData = {
      A:{ word:"Apple", icon:"üçé" }, B:{ word:"Bee", icon:"üêù" }, C:{ word:"Cat", icon:"üê±" },
      D:{ word:"Dog", icon:"üê∂" }, E:{ word:"Egg", icon:"ü•ö" }, F:{ word:"Fish", icon:"üêü" },
      G:{ word:"Goat", icon:"üêê" }, H:{ word:"Hat", icon:"üé©" }, I:{ word:"Igloo", icon:"üèî" },
      J:{ word:"Jam", icon:"üçì" }, K:{ word:"Kite", icon:"ü™Å" }, L:{ word:"Lion", icon:"ü¶Å" },
      M:{ word:"Moon", icon:"üåô" }, N:{ word:"Nest", icon:"ü™∫" }, O:{ word:"Octopus", icon:"üêô" },
      P:{ word:"Pig", icon:"üê∑" }, Q:{ word:"Queen", icon:"üëë" }, R:{ word:"Rabbit", icon:"üê∞" },
      S:{ word:"Sun", icon:"‚òÄÔ∏è" }, T:{ word:"Truck", icon:"üöö" }, U:{ word:"Umbrella", icon:"‚òî" },
      V:{ word:"Van", icon:"üöê" }, W:{ word:"Whale", icon:"üêã" }, X:{ word:"Box (X)", icon:"üì¶" },
      Y:{ word:"Yarn", icon:"üß∂" }, Z:{ word:"Zebra", icon:"ü¶ì" }
    };
    const letterSoundUrls = letters.reduce((acc,L)=>{acc[L]="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg";return acc;}, {});
    let targetLetter = letters[Math.floor(Math.random() * letters.length)];
    let letterUppercase = true;
    function resetLetterGame(){ targetLetter = letters[Math.floor(Math.random() * letters.length)]; }

    const vowels = ["A","E","I","O","U"];
    const vowelItems = [
      { vowel:"A", icon:"üçé", hint:"apple" },
      { vowel:"A", icon:"üê±", hint:"cat" },
      { vowel:"A", icon:"üëí", hint:"hat" },
      { vowel:"E", icon:"üõèÔ∏è", hint:"bed" },
      { vowel:"E", icon:"üü•", hint:"red" },
      { vowel:"E", icon:"üéæ", hint:"net" },
      { vowel:"I", icon:"üê∑", hint:"pig" },
      { vowel:"I", icon:"üëÑ", hint:"lip" },
      { vowel:"I", icon:"ü™ë", hint:"sit" },
      { vowel:"O", icon:"üê∂", hint:"dog" },
      { vowel:"O", icon:"ü™µ", hint:"log" },
      { vowel:"O", icon:"üì¶", hint:"box" },
      { vowel:"U", icon:"‚òÄÔ∏è", hint:"sun" },
      { vowel:"U", icon:"‚òï", hint:"cup" },
      { vowel:"U", icon:"üêû", hint:"bug" }
    ];
    let targetVowelItem = vowelItems[Math.floor(Math.random() * vowelItems.length)];
    let vowelUppercase = true;
    function resetVowelGame(){ targetVowelItem = vowelItems[Math.floor(Math.random() * vowelItems.length)]; }

    const unscrambleWords = ["cat","dog","sun","pig","hat","bed","log","bug","cup","map"];
    const unscrambleWordEmoji = {
      cat:"üê±", dog:"üê∂", sun:"‚òÄÔ∏è", pig:"üê∑", hat:"üëí", bed:"üõèÔ∏è", log:"ü™µ", bug:"üêû", cup:"‚òï", map:"üó∫Ô∏è"
    };
    let currentUnscramble = null;
    let currentUnscrambleInput = "";
    let currentUnscrambleUsed = [];
    let unscrambleUppercase = true; // toggle

    function shuffleString(str){ return shuffleArray(str.split("")).join(""); }
    function pickUnscramble(){
      const word = unscrambleWords[Math.floor(Math.random() * unscrambleWords.length)];
      let scrambled = shuffleString(word);
      if (scrambled === word) scrambled = shuffleString(word);
      currentUnscrambleInput = "";
      currentUnscrambleUsed = Array(scrambled.length).fill(false);
      currentUnscramble = { word, scrambled };
    }
    pickUnscramble();

    // WH words
    const whItems = [
      { word:"Who",   emoji:"üë©üèª‚Äçü¶±üë®üèæ‚Äçü¶±üëßüèº", hint:"a person" },   // mixed people[web:252][web:261]
      { word:"What",  emoji:"üì¶",             hint:"a thing" },
      { word:"When",  emoji:"‚è∞",             hint:"a time" },
      { word:"Where", emoji:"üó∫Ô∏è",            hint:"a place" },    // treasure map[web:247][web:249]
      { word:"Why",   emoji:"‚ùì",             hint:"a reason" },
      { word:"How",   emoji:"üõ†Ô∏è",            hint:"a way" }
    ];
    let currentWh = null;

    const pages = [];
    pages.push({ type:"home" });

    pages.push({ type:"sectionHeader", title:"Numbers 1‚Äì10" });
    numberPages.forEach(p=>pages.push(p));

    pages.push({ type:"sectionHeader", title:"Missing Numbers" });
    missingPages.forEach((item,i)=>pages.push({ type:"missing", data:item, id:"missing_"+i }));

    pages.push({ type:"sectionHeader", title:"Before, After & Between" });
    relationPages.forEach((item,i)=>pages.push({ type:"relation", data:item, id:"relation_"+i }));

    pages.push({ type:"sectionHeader", title:"Fun Number Games" });
    extraPages.forEach((item,i)=>pages.push({ type:item.type, data:item, id:"extra_"+i }));

    pages.push({ type:"sectionHeader", title:"Guess My Number (1‚Äì20)" });
    pages.push({ type:"guessNumber", id:"guess_1" });

    pages.push({ type:"sectionHeader", title:"Guess the Letter" });
    pages.push({ type:"letterGame", id:"letter_1" });

    pages.push({ type:"sectionHeader", title:"Vowel Sounds" });
    pages.push({ type:"vowelGame", id:"vowel_1" });

    pages.push({ type:"sectionHeader", title:"Unscramble the Word" });
    pages.push({ type:"unscrambleGame", id:"unscramble_1" });

    pages.push({ type:"sectionHeader", title:"Who / What / When / Where / Why / How" });
    pages.push({ type:"whGame", id:"wh_1" });

    pages.push({ type:"prizeCollection" });
    pages.push({ type:"finish" });

    let currentPage = 0;
    const pageDiv = document.getElementById("page");
    const homeBtn = document.getElementById("homeBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    function firstIndexOfType(type){ return pages.findIndex(p=>p.type===type); }

    function renderActivityNumberLine(){
      const base = [1,2,3,4,5,6,7,8,9,10];
      const nums = scrambleActivities ? shuffleArray(base) : base;
      return `
        <div class="number-line">
          ${nums.map(num=>`
            <div class="number-bubble" data-activity-num="${num}"
                 onclick="clickActivityBubble(${num})">${num}</div>
          `).join("")}
        </div>
        <div class="scramble-toggle">
          <label>
            <input type="checkbox" id="scrambleToggle" ${scrambleActivities?"checked":""}
                   onchange="toggleScramble()" />
            Scramble numbers
          </label>
        </div>`;
    }

    function goToNextPage() {
      if (currentPage < pages.length - 1) {
        currentPage++;
        renderPage();
      }
    }

    function renderPage(){
      const p = pages[currentPage];
      let html = "";

      if (p.type==="home"){
        html += `
          <h1>My Number & Letter Adventure</h1>
          <div class="tagline">Tap a button to choose your game.</div>
          <div class="home-grid">
            <button class="home-btn" onclick="goToSection('number')"><b>Numbers 1‚Äì10</b>Learn each number</button>
            <button class="home-btn" onclick="goToSection('missing')"><b>Missing Numbers</b>Fill in blanks</button>
            <button class="home-btn" onclick="goToSection('relation')"><b>Before / After</b>Number line help</button>
            <button class="home-btn" onclick="goToSection('games')"><b>Number Games</b>Matching & patterns</button>
            <button class="home-btn" onclick="goToSection('guess')"><b>Guess My Number</b>1‚Äì20 higher / lower</button>
            <button class="home-btn" onclick="goToSection('letter')"><b>Guess the Letter</b>Emoji & sounds</button>
            <button class="home-btn" onclick="goToSection('vowel')"><b>Vowel Sounds</b>Guess the vowel</button>
            <button class="home-btn" onclick="goToSection('unscramble')"><b>Unscramble</b>Build the word</button>
            <button class="home-btn" onclick="goToSection('wh')"><b>Who / What / When...</b>Question words</button>
            <button class="home-btn" onclick="goToSection('prizes')"><b>Prize Collection</b>See your gifts</button>
          </div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="number"){
        const n = p.n;
        html += `
          <div class="pill">Number ${n}</div>
          <h2>This is number</h2>
          <div class="big-number">${n}</div>
          <div class="word">${numberWords[n]}</div>
          <div class="dots">${"<span class='dot'></span>".repeat(n)}</div>
          <p>Say the number out loud, then count the dots together.</p>
          <p>Tap a number on the line to jump to that page.</p>
          ${renderActivityNumberLine()}
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="sectionHeader"){
        html += `
          <h1>${p.title}</h1>
          <p class="tagline">Get ready for a new kind of game!</p>`;
        if (!p.title.startsWith("Guess My Number") &&
            !p.title.startsWith("Guess the Letter") &&
            !p.title.startsWith("Vowel") &&
            !p.title.startsWith("Unscramble") &&
            !p.title.startsWith("Who")){
          html += renderActivityNumberLine();
          html += `<div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div><div class="collection"></div>`;
        }
      }

      if (p.type==="missing"){
        const seq = p.data.sequence;
        const id = p.id;
        html += `
          <div class="pill">Missing Number</div>
          <h2>Say the numbers out loud, then fill the box.</h2>
          <div class="sequence-row">`;
        seq.forEach((num,i)=>{
          if (num===null) html += `<input class="num-input" maxlength="2" id="${id}_i${i}" />`;
          else html += `<span>${num}</span>`;
          if (i<seq.length-1) html += " , ";
        });
        html += `</div>
          <p>Tap numbers on the line and see if they could fit. Clicking a number fills the box.</p>
          ${renderActivityNumberLine()}
          <p>Hint: Count in order and listen for the number that is missing.</p>
          <button onclick="checkMissing('${id}')">Check</button>
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="relation"){
        const d = p.data;
        const id = p.id;
        let prompt="", seqHtml="";
        if (d.mode==="before"){
          prompt="What number comes before?";
          seqHtml=`<input class="num-input" id="${id}_in" maxlength="2" /> , <span>${d.shown}</span>`;
        } else if (d.mode==="after"){
          prompt="What number comes after?";
          seqHtml=`<span>${d.shown}</span> , <input class="num-input" id="${id}_in" maxlength="2" />`;
        } else {
          prompt="What number goes between?";
          seqHtml=`<span>${d.left}</span> , <input class="num-input" id="${id}_in" maxlength="2" /> , <span>${d.right}</span>`;
        }
        html += `
          <div class="pill">${d.mode[0].toUpperCase()+d.mode.slice(1)}</div>
          <h2>${prompt}</h2>
          <div class="sequence-row">${seqHtml}</div>
          <p>Click a number on the line to put it in the box.</p>
          ${renderActivityNumberLine()}
          <button onclick="checkRelation('${id}')">Check</button>
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="match"){
        activitySelectedNumber = null;
        activitySelectedTop = null;
        const d = p.data, id=p.id;
        html += `
          <div class="pill">Match</div>
          <h2>Which number matches these dots?</h2>
          <div class="dots">${"<span class='dot'></span>".repeat(d.number)}</div>
          <p>Count the dots out loud. Then choose the right number.</p>
          <div class="choices" id="${id}_choices">
            ${d.options.map(o=>`<button class="choice-btn" onclick="selectMatch('${id}',${o})">${o}</button>`).join("")}
          </div>
          <p>Tap the matching number on the line too.</p>
          ${renderActivityNumberLine()}
          <button onclick="checkMatch('${id}')">Check answer</button>
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="nextNumber"){
        activitySelectedNumber = null;
        activitySelectedTop = null;
        const d=p.data, id=p.id;
        html += `
          <div class="pill">Next Number</div>
          <h2>What comes after ${d.start}?</h2>
          <div class="sequence-row">${d.start} , ?</div>
          <p>Start at ${d.start} and count on together.</p>
          <div class="choices" id="${id}_choices">
            ${d.options.map(o=>`<button class="choice-btn" onclick="selectNext('${id}',${o})">${o}</button>`).join("")}
          </div>
          <p>Tap the same number on the number line.</p>
          ${renderActivityNumberLine()}
          <button onclick="checkNext('${id}')">Check answer</button>
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="finishSequence"){
        activitySelectedNumber = null;
        activitySelectedTop = null;
        const d=p.data, id=p.id;
        html += `
          <div class="pill">Finish the Sequence</div>
          <h2>What comes next?</h2>
          <div class="sequence-row">${d.pattern.join(" , ")} , __</div>
          <p>Say the pattern together: ${d.pattern.join(", ")} ...?</p>
          <div class="choices" id="${id}_choices">
            ${d.choices.map(o=>`<button class="choice-btn" onclick="selectFinish('${id}',${o})">${o}</button>`).join("")}
          </div>
          <p>Tap the number on the line that you think comes next.</p>
          ${renderActivityNumberLine()}
          <button onclick="checkFinish('${id}')">Check answer</button>
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="cardPick"){
        activitySelectedNumber = null;
        activitySelectedTop = null;
        const d=p.data, id=p.id, seq=d.displaySequence;
        html += `
          <div class="pill">Number Cards</div>
          <h2>Pick the missing number card</h2>
          <div class="sequence-row">`;
        seq.forEach((num,i)=>{
          html += num===null ? "<span>__</span>" : `<span>${num}</span>`;
          if (i<seq.length-1) html += " , ";
        });
        html += `</div>
          <p>Say the numbers you see, then choose the card that fits.</p>
          <div class="card-row" id="${id}_cards">
            ${d.cardOptions.map(o=>`<div class="card" onclick="selectCard('${id}',${o})"><span>${o}</span></div>`).join("")}
          </div>
          <p>Tap the same number on the number line.</p>
          ${renderActivityNumberLine()}
          <button onclick="checkCard('${id}')">Check answer</button>
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="guessNumber"){
        if (secretNumber===null) resetGuessGame();
        const nums=[];
        if (guessStep===1) for(let n=1;n<=guessMax;n++) nums.push(n);
        else if (guessStep===2) for(let n=2;n<=guessMax;n+=2) nums.push(n);
        else for(let n=3;n<=guessMax;n+=3) nums.push(n);
        html += `
          <div class="pill">Guess My Number</div>
          <h2>I‚Äôm thinking of a number between 1 and ${guessMax}</h2>
          <p>Tap a number. I‚Äôll tell you if my secret number is higher or lower.</p>
          <div class="guess-step-buttons">
            <button class="step-btn ${guessStep===1?'active':''}" onclick="setGuessStep(1)">Count by 1s (1,2,3‚Ä¶)</button>
            <button class="step-btn ${guessStep===2?'active':''}" onclick="setGuessStep(2)">Count by 2s (2,4,6‚Ä¶)</button>
            <button class="step-btn ${guessStep===3?'active':''}" onclick="setGuessStep(3)">Count by 3s (3,6,9‚Ä¶)</button>
          </div>
          <div class="number-line">
            ${nums.map(num=>{
              const extra = eliminated[num] ? " eliminated" : "";
              return `<div class="number-bubble${extra}" data-num="${num}" onclick="clickGuessBubble(${num})">${num}</div>`;
            }).join("")}
          </div>
          <div id="guessFeedback" class="feedback">${guessMessage}</div>
          <button onclick="resetGuessAndRender()">New Secret Number</button>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="letterGame"){
        const info = letterData[targetLetter];
        const labels = letterUppercase ? letters : letters.map(l=>l.toLowerCase());
        html += `
          <div class="pill">Guess the Letter</div>
          <h2>What letter does this start with?</h2>
          <p>Look at the picture, listen to the sound, and tap the matching letter.</p>
          <div class="letter-icon">${info.icon}</div>
          <div class="case-toggle">
            <label><input type="radio" name="letterCase" ${letterUppercase?"checked":""} onclick="setLetterCase(true)" /> Uppercase</label>
            <label><input type="radio" name="letterCase" ${!letterUppercase?"checked":""} onclick="setLetterCase(false)" /> Lowercase</label>
          </div>
          <div class="letter-grid">
            ${labels.map(L=>`<button class="letter-btn" onclick="clickLetter('${L}')">${L}</button>`).join("")}
          </div>
          <div id="letterFeedback" class="feedback"></div>
          <button onclick="resetLetterAndRender()">New Picture</button>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="vowelGame"){
        const item = targetVowelItem;
        const labels = vowelUppercase ? vowels : vowels.map(v=>v.toLowerCase());
        html += `
          <div class="pill">Vowel Sounds</div>
          <h2>Which vowel sound do you hear?</h2>
          <p>Look at the picture and tap the vowel you think it uses.</p>
          <div class="letter-icon">${item.icon}</div>
          <div class="case-toggle">
            <label><input type="radio" name="vowelCase" ${vowelUppercase?"checked":""} onclick="setVowelCase(true)" /> Uppercase</label>
            <label><input type="radio" name="vowelCase" ${!vowelUppercase?"checked":""} onclick="setVowelCase(false)" /> Lowercase</label>
          </div>
          <div class="vowel-grid">
            ${labels.map(V=>`<button class="vowel-btn" onclick="clickVowel('${V}')">${V}</button>`).join("")}
          </div>
          <div id="vowelFeedback" class="feedback"></div>
          <button onclick="resetVowelAndRender()">New Vowel Picture</button>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="unscrambleGame"){
        const displayLetters = unscrambleUppercase
          ? currentUnscramble.scrambled.toUpperCase()
          : currentUnscramble.scrambled.toLowerCase();
        const displayGuess = unscrambleUppercase
          ? currentUnscrambleInput.toUpperCase()
          : currentUnscrambleInput.toLowerCase();

        html += `
          <div class="pill">Unscramble</div>
          <h2>Unscramble the word</h2>
          <p>Tap the letters to build the word.</p>
          <div class="case-toggle">
            <label>
              <input type="radio" name="unscrambleCase" ${unscrambleUppercase?"checked":""}
                     onclick="setUnscrambleCase(true)" />
              Uppercase
            </label>
            <label>
              <input type="radio" name="unscrambleCase" ${!unscrambleUppercase?"checked":""}
                     onclick="setUnscrambleCase(false)" />
              Lowercase
            </label>
          </div>
          <div class="unscramble-letters">
            ${displayLetters.split("").map((ch,idx) => `
              <div class="unscramble-letter-box ${currentUnscrambleUsed[idx] ? "used" : ""}"
                   onclick="clickUnscrambleLetter(${idx})">${ch}</div>
            `).join("")}
          </div>
          <input id="unscrambleInput" class="unscramble-input" maxlength="3"
                 value="${displayGuess}" readonly />
          <div>
            <button onclick="checkUnscramble()">Check</button>
            <button onclick="newUnscramble()">New Word</button>
            <button onclick="clearUnscramble()">Clear</button>
          </div>
          <div id="unscrambleFeedback" class="feedback"></div>
          <div id="unscrambleEmoji" class="unscramble-emoji"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="whGame"){
        html += `
          <div class="pill">Question Words</div>
          <h2>Tap a word to make it big!</h2>
          <p>These words help us ask questions.</p>
          <div class="wh-grid">
            ${whItems.map(it=>`<button class="wh-btn" onclick="clickWh('${it.word}')">${it.word}</button>`).join("")}
          </div>
          <div class="wh-display">
            ${currentWh ? `
              <div class="wh-emoji">${currentWh.emoji}</div>
              <div class="wh-big-word">${currentWh.word}</div>
              <p>${currentWh.word} asks about ${currentWh.hint}.</p>
            ` : `<p>Tap one of the words to see it big.</p>`}
          </div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      if (p.type==="prizeCollection"){
        html += `
          <h1>Your Prize Collection</h1>
          <p class="tagline">See all the fun things you‚Äôve won!</p>
          <div class="collection"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <p>Tap Home to play more games and win more prizes.</p>`;
      }

      if (p.type==="finish"){
        html += `
          <h1>Yay! You did it!</h1>
          <p class="tagline">You played with numbers and letters, and collected fun gifts!</p>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>`;
      }

      pageDiv.innerHTML = html;
      updateStatsDisplay();
    }

    window.toggleScramble = function(){ scrambleActivities=!scrambleActivities; renderPage(); };

    window.clickActivityBubble = function(num){
      const bubbles = document.querySelectorAll(".number-bubble[data-activity-num]");
      bubbles.forEach(b=>b.classList.remove("clicked"));
      const bubble = document.querySelector(`.number-bubble[data-activity-num="${num}"]`);
      if (bubble) bubble.classList.add("clicked");

      const p = pages[currentPage];

      // relation pages: put value in box
      if (p.type === "relation") {
        const input = document.getElementById(p.id + "_in");
        if (input) input.value = String(num);
      }

      // missing-number pages: fill first empty missing box
      if (p.type === "missing") {
        const seq = p.data.sequence;
        for (let i = 0; i < seq.length; i++) {
          if (seq[i] === null) {
            const box = document.getElementById(p.id + "_i" + i);
            if (box && !box.value) {
              box.value = String(num);
              break;
            }
          }
        }
      }

      // numbers 1‚Äì10: clicking number line jumps to that page
      if (p.type === "number") {
        const idx = pages.findIndex(pg => pg.type === "number" && pg.n === num);
        if (idx !== -1) {
          currentPage = idx;
          renderPage();
          return;
        }
      }

      // number games: remember which bottom number was chosen
      if (["match","nextNumber","finishSequence","cardPick"].includes(p.type)) {
        activitySelectedNumber = num;
      }
    };

    window.goToSection = function(section){
      let idx = 0;
      if (section==="number") idx = firstIndexOfType("number");
      else if (section==="missing") idx = firstIndexOfType("missing");
      else if (section==="relation") idx = firstIndexOfType("relation");
      else if (section==="games") idx = firstIndexOfType("match");
      else if (section==="guess") idx = firstIndexOfType("guessNumber");
      else if (section==="letter") idx = firstIndexOfType("letterGame");
      else if (section==="vowel") idx = firstIndexOfType("vowelGame");
      else if (section==="unscramble") idx = firstIndexOfType("unscrambleGame");
      else if (section==="wh") idx = firstIndexOfType("whGame");
      else if (section==="prizes") idx = firstIndexOfType("prizeCollection");
      if (idx>=0){ currentPage=idx; renderPage(); }
    };

    // missing & relation checks
    window.checkMissing = function(id){
      const page = pages.find(p=>p.id===id);
      const data = page.data;
      const fb = document.getElementById(id+"_feedback");
      const seq = data.sequence, expected = data.answers;
      const inputs=[];
      seq.forEach((n,i)=>{
        if (n===null){
          const el = document.getElementById(id+"_i"+i);
          if (el) inputs.push(parseInt(el.value,10));
        }
      });
      let correct = inputs.length===expected.length && inputs.every((v,i)=>v===expected[i]);
      totalGuesses++;
      if (correct){
        fb.textContent="Great job! You found the missing number!";
        fb.className="feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        fb.textContent="Try again. Count the numbers out loud and listen for the missing one.";
        fb.className="feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.checkRelation = function(id){
      const page = pages.find(p=>p.id===id);
      const d = page.data;
      const fb = document.getElementById(id+"_feedback");
      const input = document.getElementById(id+"_in");
      const val = parseInt(input.value,10);
      totalGuesses++;
      if (val===d.answer){
        fb.textContent="Yes! That number fits perfectly.";
        fb.className="feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        fb.textContent="Not quite. Use the number buttons and try again.";
        fb.className="feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    // NUMBER GAMES ‚Äì top selections + checks

    window.selectMatch = function(id, choice) {
      playSound("soundClick");
      activitySelectedTop = choice;
      const wrap = document.getElementById(id + "_choices");
      if (wrap) {
        wrap.querySelectorAll(".choice-btn").forEach(btn => btn.classList.remove("selected"));
        const btn = Array.from(wrap.querySelectorAll(".choice-btn")).find(b => b.textContent.trim() === String(choice));
        if (btn) btn.classList.add("selected");
      }
    };

    window.checkMatch = function(id) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const fb = document.getElementById(id + "_feedback");

      if (activitySelectedTop == null || activitySelectedNumber == null) {
        fb.textContent = "Pick a number above and tap a number on the line, then press Check.";
        fb.className = "feedback bad";
        return;
      }

      totalGuesses++;
      if (activitySelectedTop === d.number && activitySelectedNumber === d.number) {
        fb.textContent = "You matched the dots and the number!";
        fb.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
        goToNextPage();
      } else {
        fb.textContent = "Try again. Make sure both choices match the dots.";
        fb.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.selectNext = function(id, choice) {
      playSound("soundClick");
      activitySelectedTop = choice;
      const wrap = document.getElementById(id + "_choices");
      if (wrap) {
        wrap.querySelectorAll(".choice-btn").forEach(btn => btn.classList.remove("selected"));
        const btn = Array.from(wrap.querySelectorAll(".choice-btn")).find(b => b.textContent.trim() === String(choice));
        if (btn) btn.classList.add("selected");
      }
    };

    window.checkNext = function(id) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const fb = document.getElementById(id + "_feedback");

      if (activitySelectedTop == null || activitySelectedNumber == null) {
        fb.textContent = "Pick a number above and tap a number on the line, then press Check.";
        fb.className = "feedback bad";
        return;
      }

      const correct = d.start + 1;
      totalGuesses++;
      if (activitySelectedTop === correct && activitySelectedNumber === correct) {
        fb.textContent = "Yes! That‚Äôs the next number.";
        fb.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
        goToNextPage();
      } else {
        fb.textContent = "Try again. Say the numbers in order and see what comes after.";
        fb.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.selectFinish = function(id, choice) {
      playSound("soundClick");
      activitySelectedTop = choice;
      const wrap = document.getElementById(id + "_choices");
      if (wrap) {
        wrap.querySelectorAll(".choice-btn").forEach(btn => btn.classList.remove("selected"));
        const btn = Array.from(wrap.querySelectorAll(".choice-btn")).find(b => b.textContent.trim() === String(choice));
        if (btn) btn.classList.add("selected");
      }
    };

    window.checkFinish = function(id) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const fb = document.getElementById(id + "_feedback");

      if (activitySelectedTop == null || activitySelectedNumber == null) {
        fb.textContent = "Pick a number above and tap a number on the line, then press Check.";
        fb.className = "feedback bad";
        return;
      }

      totalGuesses++;
      if (activitySelectedTop === d.correctNext && activitySelectedNumber === d.correctNext) {
        fb.textContent = "Nice! You finished the sequence!";
        fb.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
        goToNextPage();
      } else {
        fb.textContent = "Say the pattern again and see what comes next.";
        fb.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.selectCard = function(id, choice) {
      playSound("soundClick");
      activitySelectedTop = choice;
      const row = document.getElementById(id + "_cards");
      if (row) {
        row.querySelectorAll(".card").forEach(c => c.classList.remove("selected"));
        const card = Array.from(row.querySelectorAll(".card")).find(c => c.textContent.trim() === String(choice));
        if (card) card.classList.add("selected");
      }
    };

    window.checkCard = function(id) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const fb = document.getElementById(id + "_feedback");

      if (activitySelectedTop == null || activitySelectedNumber == null) {
        fb.textContent = "Pick a card and tap the same number on the line, then press Check.";
        fb.className = "feedback bad";
        return;
      }

      totalGuesses++;
      if (activitySelectedTop === d.correct && activitySelectedNumber === d.correct) {
        fb.textContent = "Perfect pick! That card completes the sequence.";
        fb.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
        goToNextPage();
      } else {
        fb.textContent = "Look at the numbers and think: which one belongs in the space?";
        fb.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    // Guess My Number
    window.clickGuessBubble = function(num){
      if (secretNumber===null) resetGuessGame();
      playSound("soundClick");
      const bubbles=document.querySelectorAll(".number-bubble[data-num]");
      bubbles.forEach(b=>b.classList.remove("clicked","correct"));
      const bubble=document.querySelector(`.number-bubble[data-num="${num}"]`);
      if (!bubble) return;
      bubble.classList.add("clicked");
      const fb=document.getElementById("guessFeedback");
      totalGuesses++;
      if (num===secretNumber){
        bubble.classList.add("correct");
        guessMessage="You got it! My secret number was "+secretNumber+"!";
        fb.className="feedback good";
        playSound("soundSuccess");
        handleWin();
      } else if (num<secretNumber){
        guessMessage="Higher than "+num+". Tap a bigger number.";
        fb.className="feedback bad";
        playSound("soundError");
        for (let i=1;i<=num;i++) eliminated[i]=true;
      } else {
        guessMessage="Lower than "+num+". Tap a smaller number.";
        fb.className="feedback bad";
        playSound("soundError");
        for (let i=num;i<=guessMax;i++) eliminated[i]=true;
      }
      fb.textContent=guessMessage;
      Object.keys(eliminated).forEach(n=>{
        const el=document.querySelector(`.number-bubble[data-num="${n}"]`);
        if (el) el.classList.add("eliminated");
      });
      updateStatsDisplay();
    };

    window.resetGuessAndRender = function(){ playSound("soundClick"); resetGuessGame(); renderPage(); };
    window.setGuessStep = function(step){ playSound("soundClick"); guessStep=step; renderPage(); };

    // Letter game
    window.setLetterCase = function(isUpper){ letterUppercase=isUpper; renderPage(); };
    window.clickLetter = function(label){
      const guessed = label.toUpperCase();
      const src = letterSoundUrls[guessed];
      const audio=document.getElementById("letterSound");
      if (audio && src){ audio.src=src; playSound("letterSound"); }
      const fb=document.getElementById("letterFeedback");
      totalGuesses++;
      if (guessed===targetLetter){
        fb.textContent=`Yes! ${guessed} is the first letter.`;
        fb.className="feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        fb.textContent=`That is ${label}. Listen and try another letter.`;
        fb.className="feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };
    window.resetLetterAndRender = function(){ playSound("soundClick"); resetLetterGame(); renderPage(); };

    // Vowel game
    window.setVowelCase = function(isUpper){ vowelUppercase=isUpper; renderPage(); };
    window.clickVowel = function(label){
      const guessed = label.toUpperCase();
      const fb=document.getElementById("vowelFeedback");
      totalGuesses++;
      if (guessed===targetVowelItem.vowel){
        fb.textContent=`Yes! That picture uses the ${guessed} sound.`;
        fb.className="feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        fb.textContent=`That is ${label}. Listen for a different vowel sound.`;
        fb.className="feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };
    window.resetVowelAndRender = function(){ playSound("soundClick"); resetVowelGame(); renderPage(); };

    // Unscramble
    window.setUnscrambleCase = function(isUpper){
      unscrambleUppercase = isUpper;
      renderPage();
    };

    window.clickUnscrambleLetter = function(idx){
      playSound("soundClick");
      if (currentUnscrambleUsed[idx]) return;
      if (currentUnscrambleInput.length >= currentUnscramble.word.length) return;
      const letter = currentUnscramble.scrambled[idx];
      currentUnscrambleInput += letter;
      currentUnscrambleUsed[idx] = true;
      renderPage();
    };

    window.clearUnscramble = function(){
      playSound("soundClick");
      currentUnscrambleInput="";
      currentUnscrambleUsed = currentUnscrambleUsed.map(()=>false);
      renderPage();
    };

    window.checkUnscramble = function(){
      const feedback = document.getElementById("unscrambleFeedback");
      const emojiDiv = document.getElementById("unscrambleEmoji");
      const guess=(currentUnscrambleInput||"").toLowerCase();
      totalGuesses++;
      if (guess===currentUnscramble.word){
        feedback.textContent="Nice! You unscrambled the word "+currentUnscramble.word+"!";
        feedback.className="feedback good";
        emojiDiv.textContent = unscrambleWordEmoji[currentUnscramble.word] || "";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent="Try again. Tap the letters in order to build the word.";
        feedback.className="feedback bad";
        emojiDiv.textContent="";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.newUnscramble = function(){
      playSound("soundClick");
      pickUnscramble();
      renderPage();
    };

    // WH words
    window.clickWh = function(word){
      const found = whItems.find(w=>w.word===word);
      if (found){ currentWh=found; renderPage(); }
    };

    homeBtn.addEventListener("click", ()=>{ currentPage=0; renderPage(); });
    prevBtn.addEventListener("click", ()=>{ if (currentPage>0){ currentPage--; renderPage(); } });
    nextBtn.addEventListener("click", ()=>{ if (currentPage<pages.length-1){ currentPage++; renderPage(); } });

    resetGuessGame();
    renderPage();
  </script>
</body>
</html>
