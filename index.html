<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kindergarten Number & Letter Adventure</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ffe0f7, #e3f2fd);
      display: flex;
      align-items: stretch;
      justify-content: stretch;
    }
    .app {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .page {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
      text-align: center;
    }
    h1 {
      font-size: 26px;
      margin: 4px 0 10px;
      color: #6a1b9a;
    }
    h2 {
      font-size: 22px;
      margin: 8px 0;
      color: #3949ab;
    }
    p {
      margin: 4px 0;
    }
    .big-number {
      font-size: 90px;
      font-weight: bold;
      margin: 10px 0 4px;
      color: #ff7043;
      text-shadow: 0 3px 0 #ffccbc;
      border-radius: 24px;
      padding: 10px 24px;
      background: linear-gradient(135deg, #ffe0b2, #ffccbc);
      border: 3px solid #ffab91;
    }
    .word {
      font-size: 22px;
      margin-bottom: 10px;
      text-transform: capitalize;
      color: #5d4037;
    }
    .dots {
      margin: 10px 0 8px;
    }
    .dot {
      display: inline-block;
      width: 20px;
      height: 20px;
      margin: 4px;
      border-radius: 50%;
      background: #ffca28;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      padding: 8px 16px 12px;
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(4px);
    }
    button {
      background: #42a5f5;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
    }
    button:disabled {
      background: #cfd8dc;
      cursor: default;
    }
    .pill {
      display: inline-block;
      padding: 4px 12px;
      font-size: 13px;
      border-radius: 999px;
      background: #e3f2fd;
      color: #1976d2;
      margin-bottom: 8px;
    }
    .tagline {
      font-size: 15px;
      color: #7e57c2;
      margin-bottom: 6px;
    }
    .sequence-row {
      font-size: 28px;
      margin: 14px 0;
    }
    .num-input {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      border: 2px solid #90a4ae;
      text-align: center;
      font-size: 22px;
      margin: 0 4px;
    }
    .feedback {
      min-height: 22px;
      font-size: 15px;
      margin-top: 8px;
    }
    .good {
      color: #2e7d32;
    }
    .bad {
      color: #c62828;
    }
    .choices {
      margin: 10px 0;
    }
    .choice-btn {
      background: #fff3e0;
      color: #ef6c00;
      border-radius: 18px;
      border: 2px solid #ffb74d;
      margin: 4px;
      padding: 8px 12px;
      font-size: 18px;
      cursor: pointer;
      font-weight: bold;
    }
    .card-row {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 12px;
    }
    .card {
      width: 80px;
      height: 80px;
      border-radius: 16px;
      border: 2px solid #ce93d8;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f3e5f5;
      cursor: pointer;
    }
    .card span {
      font-size: 30px;
      color: #6a1b9a;
      font-weight: bold;
    }
    .home-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 16px;
      width: 100%;
      max-width: 480px;
    }
    .home-btn {
      border-radius: 16px;
      border: 2px solid #bbdefb;
      background: #e3f2fd;
      padding: 12px 6px;
      font-size: 14px;
      color: #1e88e5;
      cursor: pointer;
    }
    .home-btn b {
      display: block;
      font-size: 15px;
      margin-bottom: 4px;
    }
    .number-line {
      display: grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 8px;
      margin: 16px 0 8px;
      max-width: 520px;
      width: 100%;
    }
    .number-bubble {
      width: 46px;
      height: 46px;
      border-radius: 18px;
      border: 3px solid #90caf9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: bold;
      background: #e3f2fd;
      cursor: pointer;
      transition: transform 0.15s, background 0.15s, border-color 0.15s, box-shadow 0.15s, opacity 0.15s;
      box-shadow: 0 2px 0 #bbdefb;
    }
    .number-bubble.clicked {
      border-color: #42a5f5;
      background: #bbdefb;
      transform: scale(1.12);
      box-shadow: 0 3px 0 #90caf9;
    }
    .number-bubble.correct {
      border-color: #2e7d32;
      background: #c8e6c9;
    }
    .number-bubble.eliminated {
      opacity: 0.25;
    }
    .guess-step-buttons {
      margin-top: 8px;
    }
    .step-btn {
      background: #fffde7;
      color: #f9a825;
      border-radius: 16px;
      border: 2px solid #fff59d;
      padding: 4px 10px;
      margin: 0 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
    }
    .step-btn.active {
      background: #fff9c4;
      border-color: #fbc02d;
    }
    .scramble-toggle {
      margin-top: 6px;
      font-size: 13px;
      color: #455a64;
    }
    .scramble-toggle label {
      cursor: pointer;
    }
    .stats {
      margin-top: 6px;
      font-size: 14px;
      color: #37474f;
    }
    .present-modal {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background-color: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .present-content {
      background: #ffffff;
      border-radius: 20px;
      padding: 20px 24px;
      text-align: center;
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }
    .present-emoji {
      font-size: 48px;
      margin-bottom: 8px;
    }
    .collection {
      margin-top: 6px;
      font-size: 18px;
      color: #5d4037;
    }
    .collection span {
      font-size: 26px;
      margin: 0 4px;
    }
    /* Letter & vowel games */
    .letter-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 6px;
      margin: 12px 0;
      max-width: 520px;
      width: 100%;
    }
    .letter-btn {
      background: #ffe0b2;
      border-radius: 14px;
      border: 2px solid #ffb74d;
      padding: 6px 0;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }
    .letter-icon {
      font-size: 64px;
      margin-top: 8px;
    }
    .case-toggle {
      margin-top: 8px;
      font-size: 13px;
      color: #455a64;
    }
    .case-toggle label {
      cursor: pointer;
      margin: 0 8px;
    }
    .vowel-grid {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 12px 0;
    }
  </style>
</head>
<body>
  <!-- Present popup -->
  <div id="presentModal" class="present-modal">
    <div class="present-content">
      <div class="present-emoji">üéÅ</div>
      <h2>Wow! You won a prize!</h2>
      <p>Check your collection to see what you got!</p>
      <button onclick="closePresentPopup()">Close</button>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="soundClick" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
  <audio id="soundError" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
  <audio id="soundSuccess" src="https://assets.mixkit.co/active_storage/sfx/2014/2014-preview.mp3"></audio>
  <audio id="letterSound" src=""></audio>

  <div class="app">
    <div id="page" class="page"></div>
    <div class="nav">
      <button id="homeBtn">üè† Home</button>
      <button id="prevBtn">‚óÄ Back</button>
      <button id="nextBtn">Next ‚ñ∂</button>
    </div>
  </div>

  <script>
    function playSound(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.currentTime = 0;
      el.play().catch(() => {});
    }

    function showPresentPopup() {
      const modal = document.getElementById("presentModal");
      if (!modal) return;
      modal.style.display = "flex";
    }

    window.closePresentPopup = function() {
      const modal = document.getElementById("presentModal");
      if (!modal) return;
      modal.style.display = "none";
    };

    // Fisher-Yates shuffle
    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // Global scramble and stats
    let scrambleActivities = false;
    let totalGuesses = 0;
    let totalWins = 0;

    // Gift collection as emoji icons
    const possibleGifts = ["üê∂", "üê±", "üöó", "üöÄ", "ü¶ï", "ü¶Ñ"];
    let giftCollection = [];

    function awardGift() {
      const gift = possibleGifts[Math.floor(Math.random() * possibleGifts.length)];
      giftCollection.push(gift);
    }

    function updateStatsDisplay() {
      const statsEls = document.querySelectorAll(".stats");
      statsEls.forEach(el => {
        el.textContent = `Guesses: ${totalGuesses} | Wins: ${totalWins}`;
      });
      const collEls = document.querySelectorAll(".collection");
      const text = giftCollection.length
        ? "Gifts: " + giftCollection.map(g => `<span>${g}</span>`).join("")
        : "Gifts: (keep winning to collect prizes!)";
      collEls.forEach(el => {
        el.innerHTML = text;
      });
    }

    function handleWin() {
      totalWins++;
      if (totalWins > 0 && totalWins % 5 === 0) { // gift every 5 wins[web:198][web:201]
        awardGift();
        showPresentPopup();
      }
    }

    // Words for numbers 1‚Äì10
    const numberWords = [
      "", "one","two","three","four",
      "five","six","seven","eight","nine","ten"
    ];

    // Number pages 1‚Äì10
    const numberPages = Array.from({ length: 10 }, (_, i) => {
      const n = i + 1;
      return { type: "number", n };
    });

    // Missing-number sequences
    const missingPages = [
      { sequence: [1, 2, null, 4], answers: [3] },
      { sequence: [3, null, 5], answers: [4] },
      { sequence: [3, null, 7], answers: [5] },
      { sequence: [6, 7, null, 9, 10], answers: [8] },
      { sequence: [2, null, 6, null, 10], answers: [4, 8] }
    ];

    // Before / After / Between
    const relationPages = [
      { mode: "before", shown: 5, answer: 4 },
      { mode: "after", shown: 7, answer: 8 },
      { mode: "between", left: 4, right: 6, answer: 5 }
    ];

    // Extra games
    const extraPages = [
      {
        type: "match",
        number: 4,
        options: [2, 4, 6]
      },
      {
        type: "nextNumber",
        start: 3,
        options: [2, 4, 5]
      },
      {
        type: "finishSequence",
        pattern: [1, 2, 3],
        correctNext: 4,
        choices: [4, 5, 6]
      },
      {
        type: "cardPick",
        displaySequence: [5, null, 7],
        correct: 6,
        cardOptions: [4, 6, 8]
      }
    ];

    // Guess My Number (1‚Äì20 visible, internal 0‚Äì20 allowed)
    const guessMin = 0;
    const guessMax = 20;
    let guessStep = 1;        // 1s, 2s, 3s
    let secretNumber = null;
    let guessMessage = "";
    let eliminated = {};

    function resetGuessGame() {
      secretNumber = Math.floor(Math.random() * (guessMax - guessMin + 1)) + guessMin;
      guessMessage = "Tap a number to guess. I‚Äôll say if my number is higher or lower.";
      eliminated = {};
    }

    // Letter game ‚Äì emoji icon for each letter
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    const letterData = {
      A: { word: "Apple", icon: "üçé" },
      B: { word: "Bee", icon: "üêù" },
      C: { word: "Cat", icon: "üê±" },
      D: { word: "Dog", icon: "üê∂" },
      E: { word: "Egg", icon: "ü•ö" },
      F: { word: "Fish", icon: "üêü" },
      G: { word: "Goat", icon: "üêê" },
      H: { word: "Hat", icon: "üé©" },
      I: { word: "Igloo", icon: "üè†" },
      J: { word: "Jam", icon: "üçì" },
      K: { word: "Kite", icon: "ü™Å" },
      L: { word: "Lion", icon: "ü¶Å" },
      M: { word: "Moon", icon: "üåô" },
      N: { word: "Nest", icon: "ü™∫" },
      O: { word: "Octopus", icon: "üêô" },
      P: { word: "Pig", icon: "üê∑" },
      Q: { word: "Queen", icon: "üëë" },
      R: { word: "Rabbit", icon: "üê∞" },
      S: { word: "Sun", icon: "‚òÄÔ∏è" },
      T: { word: "Truck", icon: "üöö" },
      U: { word: "Umbrella", icon: "‚òî" },
      V: { word: "Van", icon: "üöê" },
      W: { word: "Whale", icon: "üêã" },
      X: { word: "Box (X)", icon: "üì¶" },
      Y: { word: "Yarn", icon: "üß∂" },
      Z: { word: "Zebra", icon: "ü¶ì" }
    };
    const letterSoundUrls = letters.reduce((acc, L) => {
      acc[L] = "https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg";
      return acc;
    }, {});
    let targetLetter = letters[Math.floor(Math.random() * letters.length)];
    let letterUppercase = true;

    function resetLetterGame() {
      targetLetter = letters[Math.floor(Math.random() * letters.length)];
    }

    // Vowel sound game
    const vowels = ["A", "E", "I", "O", "U"];
    const vowelItems = [
      { vowel: "A", icon: "üçé" }, // apple
      { vowel: "E", icon: "ü•ö" }, // egg
      { vowel: "I", icon: "üç¶" }, // ice cream
      { vowel: "O", icon: "üêô" }, // octopus
      { vowel: "U", icon: "‚òî" }  // umbrella
    ];
    let targetVowelItem = vowelItems[Math.floor(Math.random() * vowelItems.length)];
    let vowelUppercase = true;

    function resetVowelGame() {
      targetVowelItem = vowelItems[Math.floor(Math.random() * vowelItems.length)];
    }

    // Build page list
    const pages = [];
    pages.push({ type: "home" });

    pages.push({ type: "sectionHeader", title: "Numbers 1‚Äì10" });
    numberPages.forEach(p => pages.push(p));

    pages.push({ type: "sectionHeader", title: "Missing Numbers" });
    missingPages.forEach((item, index) => {
      pages.push({ type: "missing", data: item, id: "missing_" + index });
    });

    pages.push({ type: "sectionHeader", title: "Before, After & Between" });
    relationPages.forEach((item, index) => {
      pages.push({ type: "relation", data: item, id: "relation_" + index });
    });

    pages.push({ type: "sectionHeader", title: "Fun Number Games" });
    extraPages.forEach((item, index) => {
      pages.push({ type: item.type, data: item, id: "extra_" + index });
    });

    pages.push({ type: "sectionHeader", title: "Guess My Number (1‚Äì20)" });
    pages.push({ type: "guessNumber", id: "guess_1" });

    pages.push({ type: "sectionHeader", title: "Guess the Letter" });
    pages.push({ type: "letterGame", id: "letter_1" });

    pages.push({ type: "sectionHeader", title: "Vowel Sounds" });
    pages.push({ type: "vowelGame", id: "vowel_1" });

    pages.push({ type: "prizeCollection" });

    pages.push({ type: "finish" });

    let currentPage = 0;

    const pageDiv = document.getElementById("page");
    const homeBtn = document.getElementById("homeBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    function firstIndexOfType(type) {
      return pages.findIndex(p => p.type === type);
    }

    // Number line for activities: 1‚Äì10, ordered or scrambled
    function renderActivityNumberLine() {
      const base = [1,2,3,4,5,6,7,8,9,10];
      const nums = scrambleActivities ? shuffleArray(base) : base;
      return `
        <div class="number-line">
          ${nums.map(num => `
            <div
              class="number-bubble"
              data-activity-num="${num}"
              onclick="clickActivityBubble(${num})"
            >${num}</div>
          `).join("")}
        </div>
        <div class="scramble-toggle">
          <label>
            <input type="checkbox" id="scrambleToggle" ${scrambleActivities ? "checked" : ""} onchange="toggleScramble()" />
            Scramble numbers
          </label>
        </div>
      `;
    }

    function renderPage() {
      const p = pages[currentPage];
      let html = "";

      if (p.type === "home") {
        html += `
          <h1>My Number & Letter Adventure</h1>
          <div class="tagline">Tap a button to choose your game.</div>
          <div class="home-grid">
            <button class="home-btn" onclick="goToSection('number')">
              <b>Numbers 1‚Äì10</b>
              Learn each number
            </button>
            <button class="home-btn" onclick="goToSection('missing')">
              <b>Missing Numbers</b>
              Fill in blanks
            </button>
            <button class="home-btn" onclick="goToSection('relation')">
              <b>Before / After</b>
              Number line help
            </button>
            <button class="home-btn" onclick="goToSection('games')">
              <b>Number Games</b>
              Matching & patterns
            </button>
            <button class="home-btn" onclick="goToSection('guess')">
              <b>Guess My Number</b>
              1‚Äì20 higher / lower
            </button>
            <button class="home-btn" onclick="goToSection('letter')">
              <b>Guess the Letter</b>
              Emoji & sounds
            </button>
            <button class="home-btn" onclick="goToSection('vowel')">
              <b>Vowel Sounds</b>
              Guess the vowel
            </button>
            <button class="home-btn" onclick="goToSection('prizes')">
              <b>Prize Collection</b>
              See your gifts
            </button>
          </div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "number") {
        const n = p.n;
        html += `
          <div class="pill">Number ${n}</div>
          <h2>This is number</h2>
          <div class="big-number">${n}</div>
          <div class="word">${numberWords[n]}</div>
          <div class="dots">
            ${"<span class='dot'></span>".repeat(n)}
          </div>
          <p>Say the number out loud, then count the dots together.</p>
          <p>Tap a number on the line that matches this page.</p>
          ${renderActivityNumberLine()}
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "sectionHeader") {
        html += `
          <h1>${p.title}</h1>
          <p class="tagline">Get ready for a new kind of game!</p>
        `;
        if (!p.title.startsWith("Guess My Number") && !p.title.startsWith("Guess the Letter") && !p.title.startsWith("Vowel")) {
          html += renderActivityNumberLine();
          html += `<div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div><div class="collection"></div>`;
        }
      }

      if (p.type === "missing") {
        const seq = p.data.sequence;
        const id = p.id;
        html += `
          <div class="pill">Missing Number</div>
          <h2>Say the numbers out loud, then fill the box.</h2>
          <div class="sequence-row">
        `;
        seq.forEach((num, i) => {
          if (num === null) {
            html += `<input class="num-input" maxlength="2" id="${id}_i${i}" />`;
          } else {
            html += `<span>${num}</span>`;
          }
          if (i < seq.length - 1) html += " , ";
        });
        html += `
          </div>
          <p>Tap numbers on the line and see if they could fit.</p>
          ${renderActivityNumberLine()}
          <p>Hint: Count in order and listen for the number that is missing.</p>
          <button onclick="checkMissing('${id}')">Check</button>
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "relation") {
        const d = p.data;
        const id = p.id;
        let prompt = "";
        let sequenceHtml = "";

        if (d.mode === "before") {
          prompt = "What number comes before?";
          sequenceHtml = `<input class="num-input" id="${id}_in" maxlength="2" /> , <span>${d.shown}</span>`;
        } else if (d.mode === "after") {
          prompt = "What number comes after?";
          sequenceHtml = `<span>${d.shown}</span> , <input class="num-input" id="${id}_in" maxlength="2" />`;
        } else {
          prompt = "What number goes between?";
          sequenceHtml = `<span>${d.left}</span> , <input class="num-input" id="${id}_in" maxlength="2" /> , <span>${d.right}</span>`;
        }

        html += `
          <div class="pill">${d.mode[0].toUpperCase() + d.mode.slice(1)}</div>
          <h2>${prompt}</h2>
          <div class="sequence-row">${sequenceHtml}</div>
          <p>Click a number on the line to put it in the box.</p>
          ${renderActivityNumberLine()}
          <button onclick="checkRelation('${id}')">Check</button>
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "match") {
        const d = p.data;
        const id = p.id;
        html += `
          <div class="pill">Match</div>
          <h2>Which number matches these dots?</h2>
          <div class="dots">
            ${"<span class='dot'></span>".repeat(d.number)}
          </div>
          <p>Count the dots out loud. Then choose the right number.</p>
          <div class="choices">
            ${d.options.map(o => `
              <button class="choice-btn" onclick="checkChoice('${id}', ${o})">${o}</button>
            `).join("")}
          </div>
          <p>Tap the matching number on the line too.</p>
          ${renderActivityNumberLine()}
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "nextNumber") {
        const d = p.data;
        const id = p.id;
        html += `
          <div class="pill">Next Number</div>
          <h2>What comes after ${d.start}?</h2>
          <div class="sequence-row">${d.start} , ?</div>
          <p>Start at ${d.start} and count on together.</p>
          <div class="choices">
            ${d.options.map(o => `
              <button class="choice-btn" onclick="checkNext('${id}', ${o})">${o}</button>
            `).join("")}
          </div>
          <p>Find ${d.start + 1} on the number line.</p>
          ${renderActivityNumberLine()}
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "finishSequence") {
        const d = p.data;
        const id = p.id;
        html += `
          <div class="pill">Finish the Sequence</div>
          <h2>What comes next?</h2>
          <div class="sequence-row">
            ${d.pattern.join(" , ")} , __
          </div>
          <p>Say the pattern together: ${d.pattern.join(", ")} ...?</p>
          <div class="choices">
            ${d.choices.map(o => `
              <button class="choice-btn" onclick="checkFinish('${id}', ${o})">${o}</button>
            `).join("")}
          </div>
          <p>Tap the number on the line that you think comes next.</p>
          ${renderActivityNumberLine()}
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "cardPick") {
        const d = p.data;
        const id = p.id;
        const seq = d.displaySequence;
        html += `
          <div class="pill">Number Cards</div>
          <h2>Pick the missing number card</h2>
          <div class="sequence-row">
        `;
        seq.forEach((num, i) => {
          if (num === null) {
            html += `<span>__</span>`;
          } else {
            html += `<span>${num}</span>`;
          }
          if (i < seq.length - 1) html += " , ";
        });
        html += `
          </div>
          <p>Say the numbers you see, then choose the card that fits.</p>
          <div class="card-row">
            ${d.cardOptions.map(o => `
              <div class="card" onclick="checkCard('${id}', ${o})">
                <span>${o}</span>
              </div>
            `).join("")}
          </div>
          <p>Tap the same number on the number line.</p>
          ${renderActivityNumberLine()}
          <div id="${id}_feedback" class="feedback"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "guessNumber") {
        if (secretNumber === null) {
          resetGuessGame();
        }
        const numbers = [];
        if (guessStep === 1) {
          for (let n = 1; n <= guessMax; n += 1) numbers.push(n);
        } else if (guessStep === 2) {
          for (let n = 2; n <= guessMax; n += 2) numbers.push(n); // 2,4,6‚Ä¶[web:111]
        } else {
          for (let n = 3; n <= guessMax; n += 3) numbers.push(n); // 3,6,9‚Ä¶[web:112]
        }
        html += `
          <div class="pill">Guess My Number</div>
          <h2>I‚Äôm thinking of a number between 1 and ${guessMax}</h2>
          <p>Tap a number. I‚Äôll tell you if my secret number is higher or lower.</p>
          <div class="guess-step-buttons">
            <button class="step-btn ${guessStep === 1 ? 'active' : ''}" onclick="setGuessStep(1)">Count by 1s (1,2,3‚Ä¶)</button>
            <button class="step-btn ${guessStep === 2 ? 'active' : ''}" onclick="setGuessStep(2)">Count by 2s (2,4,6‚Ä¶)</button>
            <button class="step-btn ${guessStep === 3 ? 'active' : ''}" onclick="setGuessStep(3)">Count by 3s (3,6,9‚Ä¶)</button>
          </div>
          <div class="number-line">
            ${numbers.map(num => {
              const extraClass = eliminated[num] ? " eliminated" : "";
              return `
                <div
                  class="number-bubble${extraClass}"
                  data-num="${num}"
                  onclick="clickGuessBubble(${num})"
                >${num}</div>
              `;
            }).join("")}
          </div>
          <div id="guessFeedback" class="feedback">${guessMessage}</div>
          <button onclick="resetGuessAndRender()">New Secret Number</button>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "letterGame") {
        const info = letterData[targetLetter];
        const labelLetters = letterUppercase ? letters : letters.map(l => l.toLowerCase());
        html += `
          <div class="pill">Guess the Letter</div>
          <h2>What letter does this start with?</h2>
          <p>Look at the picture, listen to the sound, and tap the matching letter.</p>
          <div class="letter-icon">${info.icon}</div>
          <div class="case-toggle">
            <label>
              <input type="radio" name="letterCase" value="upper" ${letterUppercase ? "checked" : ""} onclick="setLetterCase(true)" />
              Uppercase
            </label>
            <label>
              <input type="radio" name="letterCase" value="lower" ${!letterUppercase ? "checked" : ""} onclick="setLetterCase(false)" />
              Lowercase
            </label>
          </div>
          <div class="letter-grid">
            ${labelLetters.map(L => `
              <button class="letter-btn" onclick="clickLetter('${L}')">${L}</button>
            `).join("")}
          </div>
          <div id="letterFeedback" class="feedback"></div>
          <button onclick="resetLetterAndRender()">New Picture</button>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "vowelGame") {
        const item = targetVowelItem;
        const labelVowels = vowelUppercase ? vowels : vowels.map(v => v.toLowerCase());
        html += `
          <div class="pill">Vowel Sounds</div>
          <h2>Which vowel sound do you hear?</h2>
          <p>Look at the picture and tap the vowel you think it uses.</p>
          <div class="letter-icon">${item.icon}</div>
          <div class="case-toggle">
            <label>
              <input type="radio" name="vowelCase" value="upper" ${vowelUppercase ? "checked" : ""} onclick="setVowelCase(true)" />
              Uppercase
            </label>
            <label>
              <input type="radio" name="vowelCase" value="lower" ${!vowelUppercase ? "checked" : ""} onclick="setVowelCase(false)" />
              Lowercase
            </label>
          </div>
          <div class="vowel-grid">
            ${labelVowels.map(V => `
              <button class="letter-btn" onclick="clickVowel('${V}')">${V}</button>
            `).join("")}
          </div>
          <div id="vowelFeedback" class="feedback"></div>
          <button onclick="resetVowelAndRender()">New Vowel Picture</button>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      if (p.type === "prizeCollection") {
        html += `
          <h1>Your Prize Collection</h1>
          <p class="tagline">See all the fun things you‚Äôve won!</p>
          <div class="collection"></div>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <p>Tap Home to play more games and win more prizes.</p>
        `;
      }

      if (p.type === "finish") {
        html += `
          <h1>Yay! You did it!</h1>
          <p class="tagline">You played with numbers and letters, and collected fun gifts!</p>
          <div class="stats">Guesses: ${totalGuesses} | Wins: ${totalWins}</div>
          <div class="collection"></div>
        `;
      }

      pageDiv.innerHTML = html;

      if (p.type === "guessNumber") {
        Object.keys(eliminated).forEach(n => {
          const el = document.querySelector('.number-bubble[data-num="' + n + '"]');
          if (el) el.classList.add("eliminated");
        });
      }

      updateStatsDisplay();
    }

    // Toggle scramble for activity number lines
    window.toggleScramble = function() {
      scrambleActivities = !scrambleActivities;
      renderPage();
    };

    // Activity bubbles: highlight and fill relation input for current page only
    window.clickActivityBubble = function(num) {
      const bubbles = document.querySelectorAll(".number-bubble[data-activity-num]");
      bubbles.forEach(b => b.classList.remove("clicked"));
      const bubble = document.querySelector('.number-bubble[data-activity-num="' + num + '"]');
      if (bubble) bubble.classList.add("clicked");

      const p = pages[currentPage];
      if (p.type === "relation") {
        const id = p.id;
        const input = document.getElementById(id + "_in");
        if (input) input.value = String(num);
      }
    };

    // Navigation from home (no sound)
    window.goToSection = function(section) {
      let targetIndex = 0;
      if (section === "number") {
        targetIndex = firstIndexOfType("number");
      } else if (section === "missing") {
        targetIndex = firstIndexOfType("missing");
      } else if (section === "relation") {
        targetIndex = firstIndexOfType("relation");
      } else if (section === "games") {
        targetIndex = firstIndexOfType("match");
      } else if (section === "guess") {
        targetIndex = firstIndexOfType("guessNumber");
      } else if (section === "letter") {
        targetIndex = firstIndexOfType("letterGame");
      } else if (section === "vowel") {
        targetIndex = firstIndexOfType("vowelGame");
      } else if (section === "prizes") {
        targetIndex = firstIndexOfType("prizeCollection");
      }
      if (targetIndex >= 0) {
        currentPage = targetIndex;
        renderPage();
      }
    };

    // Check functions with stats + sounds
    window.checkMissing = function(id) {
      const page = pages.find(p => p.id === id);
      const data = page.data;
      const feedback = document.getElementById(id + "_feedback");
      const seq = data.sequence;
      const expectedAnswers = data.answers;

      const inputs = [];
      seq.forEach((num, i) => {
        if (num === null) {
          const el = document.getElementById(id + "_i" + i);
          if (el) inputs.push(parseInt(el.value, 10));
        }
      });

      let correct = true;
      if (inputs.length !== expectedAnswers.length) {
        correct = false;
      } else {
        for (let i = 0; i < inputs.length; i++) {
          if (inputs[i] !== expectedAnswers[i]) {
            correct = false;
            break;
          }
        }
      }

      totalGuesses++;
      if (correct) {
        feedback.textContent = "Great job! You found the missing number!";
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent = "Try again. Count the numbers out loud and listen for the missing one.";
        feedback.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.checkRelation = function(id) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const feedback = document.getElementById(id + "_feedback");
      const input = document.getElementById(id + "_in");
      const val = parseInt(input.value, 10);

      totalGuesses++;
      if (val === d.answer) {
        feedback.textContent = "Yes! That number fits perfectly.";
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent = "Not quite. Use the number buttons and try again.";
        feedback.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.checkChoice = function(id, choice) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const feedback = document.getElementById(id + "_feedback");

      totalGuesses++;
      if (choice === d.number) {
        feedback.textContent = "You matched the dots and the number!";
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent = "Oops! Count the dots one more time.";
        feedback.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.checkNext = function(id, choice) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const feedback = document.getElementById(id + "_feedback");

      totalGuesses++;
      if (choice === d.start + 1) {
        feedback.textContent = "Yes! That‚Äôs the next number.";
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent = "Try again. Say the numbers in order: " + d.start + ", ...";
        feedback.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.checkFinish = function(id, choice) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const feedback = document.getElementById(id + "_feedback");

      totalGuesses++;
      if (choice === d.correctNext) {
        feedback.textContent = "Nice! You finished the sequence!";
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent = "Say the pattern again and see what comes next.";
        feedback.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.checkCard = function(id, choice) {
      const page = pages.find(p => p.id === id);
      const d = page.data;
      const feedback = document.getElementById(id + "_feedback");

      totalGuesses++;
      if (choice === d.correct) {
        feedback.textContent = "Perfect pick! That card completes the sequence.";
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent = "Look at the numbers and think: which one belongs in the space?";
        feedback.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    // Guess My Number ‚Äì 1‚Äì20 visible, stats
    window.clickGuessBubble = function(num) {
      if (secretNumber === null) resetGuessGame();
      playSound("soundClick");

      const bubbles = document.querySelectorAll(".number-bubble[data-num]");
      bubbles.forEach(b => b.classList.remove("clicked", "correct"));

      const bubble = document.querySelector('.number-bubble[data-num="' + num + '"]');
      if (!bubble) return;
      bubble.classList.add("clicked");

      const feedback = document.getElementById("guessFeedback");
      totalGuesses++;

      if (num === secretNumber) {
        bubble.classList.add("correct");
        guessMessage = "You got it! My secret number was " + secretNumber + "!";
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else if (num < secretNumber) {
        guessMessage = "Higher than " + num + ". Tap a bigger number.";
        feedback.className = "feedback bad";
        playSound("soundError");
        for (let i = 1; i <= num; i++) eliminated[i] = true;
      } else {
        guessMessage = "Lower than " + num + ". Tap a smaller number.";
        feedback.className = "feedback bad";
        playSound("soundError");
        for (let i = num; i <= guessMax; i++) eliminated[i] = true;
      }

      feedback.textContent = guessMessage;
      Object.keys(eliminated).forEach(n => {
        const el = document.querySelector('.number-bubble[data-num="' + n + '"]');
        if (el) el.classList.add("eliminated");
      });
      updateStatsDisplay();
    };

    window.resetGuessAndRender = function() {
      playSound("soundClick");
      resetGuessGame();
      renderPage();
    };

    window.setGuessStep = function(step) {
      playSound("soundClick");
      guessStep = step;
      renderPage();
    };

    // Letter game ‚Äì icon first, guess letter, case toggle
    window.setLetterCase = function(isUpper) {
      letterUppercase = isUpper;
      renderPage();
    };

    window.clickLetter = function(label) {
      // label might be lower/upper; normalize to upper for logic
      const guessed = label.toUpperCase();
      const src = letterSoundUrls[guessed];
      const audio = document.getElementById("letterSound");
      if (audio && src) {
        audio.src = src;
        playSound("letterSound");
      }
      const feedback = document.getElementById("letterFeedback");
      totalGuesses++;

      if (guessed === targetLetter) {
        const data = letterData[targetLetter];
        feedback.textContent = `Yes! ${guessed} is the first letter.`;
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent = `That is ${label}. Listen and try another letter.`;
        feedback.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.resetLetterAndRender = function() {
      playSound("soundClick");
      resetLetterGame();
      renderPage();
    };

    // Vowel game ‚Äì emoji, vowel buttons with case toggle
    window.setVowelCase = function(isUpper) {
      vowelUppercase = isUpper;
      renderPage();
    };

    window.clickVowel = function(label) {
      const guessed = label.toUpperCase();
      const feedback = document.getElementById("vowelFeedback");
      totalGuesses++;

      if (guessed === targetVowelItem.vowel) {
        feedback.textContent = `Yes! That picture uses the ${guessed} sound.`;
        feedback.className = "feedback good";
        playSound("soundSuccess");
        handleWin();
      } else {
        feedback.textContent = `That is ${label}. Listen for a different vowel sound.`;
        feedback.className = "feedback bad";
        playSound("soundError");
      }
      updateStatsDisplay();
    };

    window.resetVowelAndRender = function() {
      playSound("soundClick");
      resetVowelGame();
      renderPage();
    };

    // NAVIGATION (no sound)
    homeBtn.addEventListener("click", () => {
      currentPage = 0;
      renderPage();
    });

    prevBtn.addEventListener("click", () => {
      if (currentPage > 0) {
        currentPage--;
        renderPage();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentPage < pages.length - 1) {
        currentPage++;
        renderPage();
      }
    });

    resetGuessGame();
    renderPage();
  </script>
</body>
</html>
